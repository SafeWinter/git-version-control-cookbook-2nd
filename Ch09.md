# 第九章 Git 仓库的运维

本章将介绍用于 `Git` 仓库运维工作的各类工具。例如在本地轻松删除远程库中已经删除的分支；垃圾回收的触发及关闭；利用 `filter-branch` 拆分 `Git` 仓库或修改仓库历史；最后简要介绍一下怎样以子项目的方式（应用子模块或子树策略），将 `Git` 库集成到另一个 `Git` 库。

本章相关主题：

- 整理远程仓库
- 手动执行垃圾回收
- 关闭自动垃圾回收
- 分隔仓库
- 重写提交历史 – 变更单个文件
- 以镜像的方式创建仓库备份
- 一个快捷子模块操作演示
- 子树合并
- 子模块与子树对比

---



## 9.1 整理远程仓库

项目的开发往往是在 `features` 特性分支上进行的。开发完成后并入主分支，并将原特性分支删除。对于不是推送该分支的本地库，`Git` 不会自动将分支变更信息自动更新到之前克隆的其他本地仓库，对这些本地仓库而言，必须手动同步远程分支信息。

使用命令：`git fetch --prune`

功能演示：

```bash
# Prepare repos: a bare and a clone
$ git clone --bare https://github.com/PacktPublishing/Git-Version-Control-Cookbook-Second-Edition_hello_world_flow_model.git hello_world_flow_model_remote
$ git clone hello_world_flow_model_remote hello_world_flow_model
# delete branches from the remote repo
$ cd hello_world_flow_model_remote 
$ git branch -D feature/continents  
Deleted branch feature/continents (was 5bd5222).
$ git branch -D feature/printing  
Deleted branch feature/printing (was a5da07d).
$ git branch -D release/1.0  
Deleted branch release/1.0 (was 134fe4b).
# enter cloned repo
$ cd ../hello_world_flow_model 
$ git checkout develop 
$ git reset --hard origin/develop
# Check branches from remote
$ git branch -a 
* develop
  master
  remotes/origin/HEAD -> origin/master
  remotes/origin/develop
  remotes/origin/feature/cities
  remotes/origin/feature/continents
  remotes/origin/feature/printing
  remotes/origin/master
  remotes/origin/release/1.0
# fetch with default options
$ git fetch 
$ git pull 
Already up to date. 
$ git branch -a 
* develop
  master
  remotes/origin/HEAD -> origin/master
  remotes/origin/develop
  remotes/origin/feature/cities
  remotes/origin/feature/continents
  remotes/origin/feature/printing
  remotes/origin/master
  remotes/origin/release/1.0
# Sync with remote repo by using --prune
$ git fetch --prune
From C:/Users/ad/Desktop/hello_world_flow_model_remote
 - [deleted]         (none)     -> origin/feature/continents
 - [deleted]         (none)     -> origin/feature/printing
 - [deleted]         (none)     -> origin/release/1.0
# Check again
$ git branch -a
* develop
  master
  remotes/origin/HEAD -> origin/master
  remotes/origin/develop
  remotes/origin/feature/cities
  remotes/origin/master
```

此外，也可以用 `git pull --prune` 达到相同效果，或者运行命令 `git remote prune origin`。不过，后者虽然能够删除远程库中已经不存在的分支，但不会自动更新本地的远程跟踪分支信息。



## 9.2 手动执行垃圾回收
## 9.3 关闭自动垃圾回收
## 9.4 分隔仓库
## 9.5 重写提交历史 – 变更单个文件
## 9.6 以镜像的方式创建仓库备份
## 9.7 一个快捷子模块操作演示
## 9.8 子树合并
## 9.9 子模块与子树对比















